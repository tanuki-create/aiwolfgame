# 🐺 AI人狼ゲーム - セットアップ完了

## ✅ 完了した作業

1. **Bunランタイムのインストール** ✅
2. **プロジェクト依存関係のインストール** ✅
3. **Neon PostgreSQL対応** ✅（Redisを削除し、全てNeonで管理）

---

## 🎯 次にやること（あなたの作業）

### 1. Neonデータベースを取得

https://console.neon.tech にアクセスして：
1. アカウント作成（無料）
2. 新しいプロジェクト作成
3. 接続文字列をコピー（例：`postgresql://user:pass@ep-xxx.neon.tech/neondb?sslmode=require`）

### 2. DeepSeek APIキーを取得

https://platform.deepseek.com にアクセスして：
1. アカウント作成
2. APIキーを生成
3. キーをコピー（`sk-`で始まる文字列）

### 3. `.env`ファイルを編集

プロジェクトルート（`/Users/hiromitsu/aiwolfgame/`）の`.env`ファイルを開いて、以下を更新：

```bash
# DeepSeekのAPIキーを入力（必須）
DEEPSEEK_API_KEY=sk-ここにあなたのキーを貼り付け

# Neonの接続文字列を入力（必須）
DATABASE_URL=postgresql://ここにあなたのNeon接続文字列を貼り付け
```

### 4. データベースを初期化

```bash
cd /Users/hiromitsu/aiwolfgame/apps/server
bun run init-db
```

成功すると：
```
🔧 Initializing database schema...
Creating game state tables...
Creating log tables...
✅ Database schema initialized successfully!
```

### 5. サーバーを起動

プロジェクトルートに戻って：

```bash
cd /Users/hiromitsu/aiwolfgame
bun dev
```

起動すると：
- **バックエンド**: http://localhost:4000
- **フロントエンド**: http://localhost:3000

---

## 🎮 ゲームをプレイ

1. ブラウザで http://localhost:3000 を開く
2. **「Create New Game」**をクリック
3. 役職パックを選択（または「Random Start」）
4. **「Create Game」**をクリック
5. 名前を入力して参加
6. あなた＋AIプレイヤー10人で人狼ゲーム開始！

---

## 📂 プロジェクト構造

```
/Users/hiromitsu/aiwolfgame/
├── .env                    # ← ここを編集してください！
├── NEON_SETUP.md          # Neon用セットアップガイド
├── apps/
│   ├── server/            # バックエンドサーバー
│   │   └── src/
│   │       ├── index.ts   # メインサーバー
│   │       └── init-db.ts # DB初期化スクリプト
│   └── web/               # Reactフロントエンド
├── packages/
│   ├── shared/            # 共通型定義
│   ├── fsm/              # ゲームエンジン
│   ├── llm/              # DeepSeek統合
│   └── db/               # Neonデータベース層
│       └── src/neon/     # ← Neon対応の新しいストア
└── bun.lockb             # 依存関係ロックファイル
```

---

## 🔍 主な変更点（Neon対応）

### Before（Redis + PostgreSQL）
- Redis: ゲーム状態管理
- PostgreSQL: ログ管理
- Docker必須

### After（Neon PostgreSQL）
- Neon PostgreSQL: **全て**を管理
  - ゲーム状態（`game_states`テーブル）
  - チャットログ（`public_messages`）
  - 狼チャットログ（`wolf_messages`）
  - 内部イベント（`internal_events`）
- **Docker不要**！

---

## 💡 便利なコマンド

```bash
# 依存関係の再インストール
bun install

# データベース初期化
cd apps/server && bun run init-db

# 開発サーバー起動
bun dev

# テスト実行
bun test

# ゲームシミュレーション（100試合）
cd apps/server && bun run simulate 100
```

---

## 🧪 動作確認

### データベース接続テスト

`.env`を更新したら、接続テストができます：

```bash
# PostgreSQL CLIで接続（psqlが必要）
psql "$DATABASE_URL"
```

### サーバー起動テスト

```bash
cd /Users/hiromitsu/aiwolfgame
bun dev
```

問題なく起動すれば：
```
🎮 AI Werewolf Server running on port 4000
📡 WebSocket: ws://localhost:4000/ws
🔌 REST API: http://localhost:4000/api
```

---

## 🆘 トラブルシューティング

### ポートが使用中

```bash
# ポート4000を使用しているプロセスを終了
lsof -ti:4000 | xargs kill -9

# ポート3000を使用しているプロセスを終了
lsof -ti:3000 | xargs kill -9
```

### データベース接続エラー

1. `.env`のDATABASE_URLが正しいか確認
2. Neonダッシュボードでデータベースが起動しているか確認
3. 接続文字列に`?sslmode=require`が含まれているか確認

### DeepSeek APIエラー

1. `.env`のDEEPSEEK_API_KEYが正しいか確認
2. https://platform.deepseek.com でクレジットがあるか確認
3. APIキーが有効か確認

---

## 📊 機能一覧

### コアゲーム
- ✅ 11人制人狼ゲーム（1人プレイヤー + 10AI）
- ✅ 5種類の役職拡張パック
- ✅ ランダムスタート機能
- ✅ 完全なFSM（有限状態機械）
- ✅ DeepSeek-V3 AI統合
- ✅ 決定論的シード乱数

### UI機能
- ✅ ルーム作成・参加
- ✅ リアルタイムチャット
- ✅ プレイヤーリスト
- ✅ フェーズタイマー
- ✅ 狼専用チャット（赤テーマ）
- ✅ 管理者パネル

### 開発ツール
- ✅ ユニットテストスイート
- ✅ ゲームシミュレーター
- ✅ ホットリロード対応
- ✅ 完全なAPI

---

## 🎉 準備完了！

あとは以下の3ステップだけ：

1. **Neon接続文字列**を`.env`に追加
2. **DeepSeek APIキー**を`.env`に追加
3. `bun run init-db` でデータベース初期化
4. `bun dev` でサーバー起動

それでは、楽しい人狼ゲームを！🐺

---

## 📞 サポート

問題が発生した場合：
- `NEON_SETUP.md` を参照
- サーバーログを確認
- `.env`の設定を再確認
- データベース接続をテスト

質問があればいつでもどうぞ！

